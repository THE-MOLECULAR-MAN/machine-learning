SELECT
    date(ZOBJECT.ZSTARTDATE+978307200,'UNIXEPOCH', 'LOCALTIME') as "DATE",
    round(sum(ZOBJECT.ZENDDATE-ZOBJECT.ZSTARTDATE) / 3600.0, 3 ) as "TOTAL_USAGE_PER_DAY_IN_HOURS"
FROM
    ZOBJECT 
    LEFT JOIN
    ZSTRUCTUREDMETADATA 
    ON ZOBJECT.ZSTRUCTUREDMETADATA = ZSTRUCTUREDMETADATA.Z_PK 
    LEFT JOIN
    ZSOURCE 
    ON ZOBJECT.ZSOURCE = ZSOURCE.Z_PK 
    LEFT JOIN
    ZSYNCPEER
    ON ZSOURCE.ZDEVICEID = ZSYNCPEER.ZDEVICEID
WHERE
    ZSTREAMNAME = "/app/usage"
    and
    -- only in the past, don't care about today's summary since today isn't over yet
    DATE < date('now')
GROUP BY
    DATE
ORDER BY
    DATE DESC;
